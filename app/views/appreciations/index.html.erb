<div class="max-w-7xl mx-auto">
  <div class="mb-6 md:mb-8">
    <h1 class="text-2xl md:text-3xl font-bold text-gray-900 mb-2">タイムライン</h1>
  </div>

  <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
    <!-- メインコンテンツ（左側、2/3幅） -->
    <div class="lg:col-span-2">
      <div class="bg-white border border-gray-200 shadow-sm rounded-xl p-6">
        <h2 class="text-xl font-bold text-gray-900 mb-4">最近のアクティビティ</h2>

        <!-- タブ -->
        <div class="flex gap-2 mb-4 border-b border-gray-200">
          <%= link_to appreciations_path(tab: 'timeline', category: params[:category]),
              class: "px-4 py-2 text-sm font-medium transition-all #{@tab == 'timeline' ? 'border-b-2 border-blue-600 text-blue-600' : 'text-gray-600 hover:text-gray-900'}" do %>
            全ユーザー
          <% end %>
          <%= link_to appreciations_path(tab: 'mine', category: params[:category]),
              class: "px-4 py-2 text-sm font-medium transition-all #{@tab == 'mine' ? 'border-b-2 border-blue-600 text-blue-600' : 'text-gray-600 hover:text-gray-900'}" do %>
            自分のやりとり
          <% end %>
          <%= link_to appreciations_path(tab: 'sent', category: params[:category]),
              class: "px-4 py-2 text-sm font-medium transition-all #{@tab == 'sent' ? 'border-b-2 border-blue-600 text-blue-600' : 'text-gray-600 hover:text-gray-900'}" do %>
            送信
          <% end %>
          <%= link_to appreciations_path(tab: 'received', category: params[:category]),
              class: "px-4 py-2 text-sm font-medium transition-all #{@tab == 'received' ? 'border-b-2 border-blue-600 text-blue-600' : 'text-gray-600 hover:text-gray-900'}" do %>
            受信
          <% end %>
        </div>

        <!-- アクティビティリスト -->
        <div class="space-y-6">
          <% if @appreciations.any? %>
            <% @appreciations.each do |appreciation| %>
              <%= render 'shared/appreciation_card', appreciation: appreciation %>
            <% end %>
          <% else %>
            <div class="text-center py-12">
              <p class="text-gray-500">まだ感謝メッセージがありません</p>
            </div>
          <% end %>
        </div>

        <!-- ページネーション -->
        <% if @appreciations.total_pages > 1 %>
          <div class="mt-8 flex justify-center gap-2">
            <% if @appreciations.prev_page %>
              <%= link_to "← 前へ", appreciations_path(tab: @tab, page: @appreciations.prev_page, category: params[:category]),
                  class: "px-4 py-2 rounded-md border border-gray-300 text-sm font-medium text-gray-700 hover:bg-gray-50" %>
            <% end %>

            <span class="px-4 py-2 text-sm text-gray-700">
              <%= @appreciations.current_page %> / <%= @appreciations.total_pages %>
            </span>

            <% if @appreciations.next_page %>
              <%= link_to "次へ →", appreciations_path(tab: @tab, page: @appreciations.next_page, category: params[:category]),
                  class: "px-4 py-2 rounded-md border border-gray-300 text-sm font-medium text-gray-700 hover:bg-gray-50" %>
            <% end %>
          </div>
        <% end %>
      </div>
    </div>

    <!-- サイドバー（右側、1/3幅） -->
    <div class="lg:col-span-1">
      <div class="bg-white border border-gray-200 shadow-sm rounded-xl p-6 sticky top-6">
        <h3 class="text-lg font-bold text-gray-900 mb-4">カテゴリ</h3>
        <div class="space-y-3">
          <%= link_to appreciations_path(tab: @tab), class: "block" do %>
            <div class="flex items-center justify-between p-3 rounded-lg transition-all cursor-pointer <%= params[:category].blank? ? 'bg-blue-600 text-white' : 'bg-gray-50 hover:bg-gray-100' %>">
              <span class="text-sm font-medium">
                すべて
              </span>
              <span class="text-sm font-semibold">
                <%= Appreciation.where(organization_id: Current.organization.id).count %>
              </span>
            </div>
          <% end %>
          <% Appreciation.categories.keys.each do |cat| %>
            <%= link_to appreciations_path(tab: @tab, category: cat), class: "block" do %>
              <div class="flex items-center justify-between p-3 rounded-lg transition-all cursor-pointer <%= params[:category] == cat ? 'bg-blue-600 text-white' : 'bg-gray-50 hover:bg-gray-100' %>">
                <span class="text-sm font-medium">
                  <%= I18n.t("activerecord.attributes.appreciation.categories.#{cat}") %>
                </span>
                <span class="text-sm font-semibold">
                  <%= Appreciation.where(organization_id: Current.organization.id, category: cat).count %>
                </span>
              </div>
            <% end %>
          <% end %>
        </div>
      </div>
    </div>
  </div>
</div>